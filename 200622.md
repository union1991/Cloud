Day 23.

## 목차
 
## 10. 가상화

> ### 10.1 가상화 개요
> ### 10.2 oVirt 개요

------------
 
 
## 10 가상화


가상화(Virtualization)는 컴퓨터에서 컴퓨터 리소스의 추상화를 일컫는 광범위한 용어이다. "물리적인 컴퓨터 리소스의 특징을 다른 시스템, 응용 프로그램, 최종 사용자들이 리소스와 상호 작용하는 방식으로부터 감추는 기술"로 정의할 수 있다.


------------

 
### 10.1 가상화 개요


**가상화 목적**
* Isolation(격리성) : 격리성을 보장하여 보안, 비용 등 최대한의 효율을 이끌어 낸다.


**하이퍼 바이저 개요**
* H/W를 소프트웨어적으로 파티셔닝하여 가상머신에게 제공
* 주요 기능은 시스템 자원 관리, 모니터링, 독립성 유지,주변 장치 제공


<br/>


**서버/시스템 가상화 종류**
* Baremetal/Native Virtualization(**Type 1**)
> * hardware - hypervisor - guestOS(kernel - App) 
> * hypervisor가 하드웨어를 격리 시킴(나눔)
> * hypervisor 제품 : VMware ESXi(ESX), Citrix Xen Server(Xen Open Source), RedHat RHV(KVM), Microsoft Htper-V
> * Virtualization Management 제품 : VMware vCenter, Citrix Xen Center, RedHat RHV(oVirt), MS SCVMM


   <img src="https://user-images.githubusercontent.com/56064985/85347298-1f38d800-b533-11ea-9e21-04973cc41820.png" width="40%"></img>


* Hosted Virtualization(**Type 2**)
> * hardware - hostOS(kernel - app or hypervisor) -guestOS(kernel - App) 
> * 제품 : VMWorkstation, Oracle VirtualBox


   <img src="https://user-images.githubusercontent.com/56064985/85347301-1fd16e80-b533-11ea-884e-64492b31d1ad.png" width="40%"></img>


* Full Virtualization(디스크 전가상화)
> * 가상머신이 제공받은 하드웨어가 전부 가상의 하드웨어
> * 전가상화로 만들어진 가상머신은 자신이 가상머신인지 알지 못함
> * 물리적인 하드웨어에 접근할 때 하이퍼 바이저에 의해 제어됨
> * 에뮬레이트 작업을 거치기 때문에 성능이 떨어짐
> * 대부분의 운영체제를 쉽게 설치 가능
> * Binary Translation : hypervisor와 hardware가 서로 알아들을 수 있는 언어로 변환해줌(SW였지만 지금은 HW가 지원해줌-VT)


* Para Virtualization(디스크 반가상화)
> * 운영체제의 커널 소스를 수정한 가상화
> * 전가상화보다 오버헤드가 적음
> * 운영체제의 커널 소스를 수정해야 하기 때문에 오픈소르 운영체제로 한정
> * hyper Call : APP이 hardware로 바로 명령을 내릴 수 있음


---


### 10.2 oVirt 개요

**oVirt 목적**
* Host와 Guest 시스템을 중앙에서 관리하는 가상화 플랫폼(PaaS)
* 기능 : Hardware 노드 관리, 스토리지 및 네트워크 자원 관리, 가상머신 배포 및 관리 기능


<br/>


**KVM**
* Thin Hypervisor Host
> * Baremetal형 하이퍼바이저
> * 어떤 서비스도 제공이 안됨(ssh 제외)

* Thick Hypervisor Host
> * Hosted형 하이퍼바이저
> * 운영체제에 하이퍼바이저 소프트웨어를 설치하여 사용
> * Guest 시스템을 설치하기가 쉬움


<br/>


**oVirt 설치**

* oVirt 구성도


<img src="https://user-images.githubusercontent.com/56064985/85265996-236ee200-b4ae-11ea-8ab6-1e792cabee25.png" width="90%"></img>



[ovirt thin 클라이언트]

* ovirt 서버 설치 파일 사전 작업(Ubuntu : 사용자 PC)
```
# cd /var/lib/libvirt/images     //  패키지 설치 디렉토리로 이동
# qemu-img create hyper2.raw 55G   // 서버 파일 미리 만들기
# qemu-img convert -O qcow2 hyper1.raw hyper1.qcow2

```


* ovirt 서버 설치


<img src="https://user-images.githubusercontent.com/56064985/85362434-633ed380-b559-11ea-9708-0c70119dd377.png" width="60%"></img>

<img src="https://user-images.githubusercontent.com/56064985/85362440-65089700-b559-11ea-8f32-d6f0627d6f0c.png" width="60%"></img>

<img src="https://user-images.githubusercontent.com/56064985/85362444-68038780-b559-11ea-8a89-ca43909da6ec.png" width="60%"></img>

<img src="https://user-images.githubusercontent.com/56064985/85362449-6a65e180-b559-11ea-9fc5-8501d027c735.png" width="60%"></img>

<img src="https://user-images.githubusercontent.com/56064985/85362453-6c2fa500-b559-11ea-9c28-95b94e3b5e31.png" width="60%"></img>

<img src="https://user-images.githubusercontent.com/56064985/85362456-6e91ff00-b559-11ea-82e8-18fc69422213.png" width="60%"></img>

<img src="https://user-images.githubusercontent.com/56064985/85362460-6fc32c00-b559-11ea-8bed-1db49b795668.png" width="60%"></img>

<img src="https://user-images.githubusercontent.com/56064985/85362464-72be1c80-b559-11ea-99d7-dff3dc4843d0.png" width="60%"></img>

<img src="https://user-images.githubusercontent.com/56064985/85362465-7487e000-b559-11ea-86ca-5c2b5c6ece9d.png" width="60%"></img>

<img src="https://user-images.githubusercontent.com/56064985/85362470-7651a380-b559-11ea-9e19-bbe4236f457b.png" width="60%"></img>


* ovirt 패키지 최신화 진행
```
# yum update 

```


* vi /etc/hosts 추가
```
# vi /etc/hosts

192.168.122.10  ovirt.abc.local
192.168.122.21  hyper1.abc.local
192.168.122.22  hyper2.abc.local

:wq!

```


* ssh public key 설정
```
# mkdir /root/.ssh
# chmod 700 /root/.ssh
# vi /root/.ssh/authorized.keys

sh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCnY53ST2RxdulhwysvLWxjiCRX1XbqvCiidGT5LjGgXIvvEfG8zqhiozEVW4yNVApufjsLjNOE0vMZ204Gi5PEm67ZoDDB5qsOvs93eqaR0CS0qdNuo0KzbLtFbPzGEPw9+vRsiRyk4qIgDYpYwCRkV1vn3NfAe0c+mUvxCgvyp5kfFWbSyvt7gN5tbwbX+PpSJ0HIVpfrOO6Y4R8TfZwo6pacwgLKEH4sId8L/cqfR29nIm93WJRoqGjCilD6GLldHzySjjeL+rdTsZyJzz0BtLNGSmxUxhnm3jyNs836d/bPTS0L9xx7n3oGSE3ISTh/yJBmsO5x0I+Lw4U+jfdD ovirt-engine

:wq!

```


[ovirt thick 클라이언트]
* ovirt 서버 패키지 설치
```
# yum update  // 시스템 최신화(커널)
# yum install http://resources.ovirt.org/pub/yum-repo/ovirt-release43.rpm   // ovirt 패키지 설치
# yum install qemu-kvm libvirt virt-install bridge-utils vdsm-client   // 자동 추가가 안될 경우 진행
# yum update  // ovirt 패키지 업데이트 확인
# reboot
```

* vi /etc/hosts 추가
```
# vi /etc/hosts

192.168.122.10  ovirt.abc.local
192.168.122.21  hyper1.abc.local
192.168.122.22  hyper2.abc.local

:wq!

```

* ssh public key 설정
```
# mkdir /root/.ssh
# chmod 700 /root/.ssh
# vi /root/.ssh/authorized.keys

sh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCnY53ST2RxdulhwysvLWxjiCRX1XbqvCiidGT5LjGgXIvvEfG8zqhiozEVW4yNVApufjsLjNOE0vMZ204Gi5PEm67ZoDDB5qsOvs93eqaR0CS0qdNuo0KzbLtFbPzGEPw9+vRsiRyk4qIgDYpYwCRkV1vn3NfAe0c+mUvxCgvyp5kfFWbSyvt7gN5tbwbX+PpSJ0HIVpfrOO6Y4R8TfZwo6pacwgLKEH4sId8L/cqfR29nIm93WJRoqGjCilD6GLldHzySjjeL+rdTsZyJzz0BtLNGSmxUxhnm3jyNs836d/bPTS0L9xx7n3oGSE3ISTh/yJBmsO5x0I+Lw4U+jfdD ovirt-engine

:wq!

```


* 관리 페이지에서 자동 설치가 안되면 다음을 진행(보안에 취약해지나 테스트 환경이기 때문에 진행)
```
# systemctl stop firewalld
# setenforce 0
```


[ovirt 서버]••••
* ovirt 서버 패키지 설치
```
# yum update  // 시스템 최신화(커널)
# yum install http://resources.ovirt.org/pub/yum-repo/ovirt-release43.rpm   // ovirt 패키지 설치
# yum update  // ovirt 패키지 업데이트 확인
# yum install ovirt-engine
# reboot
```


* manage 구성
```
# engine-setup

전부 기본 값으로 설치 진행
[WARNING] Less than 16384MB of memory is available
         
          --== CONFIGURATION PREVIEW ==--
         
          Application mode                        : both
          Default SAN wipe after delete           : False
          Firewall manager                        : firewalld
          Update Firewall                         : True
          Host FQDN                               : ovirt.abc.local
          Set up Cinderlib integration            : False
          Configure local Engine database         : True
          Set application as default page         : True
          Configure Apache SSL                    : True
          Engine database secured connection      : False
          Engine database user name               : engine
          Engine database name                    : engine
          Engine database host                    : localhost
          Engine database port                    : 5432
          Engine database host name validation    : False
          Engine installation                     : True
          PKI organization                        : abc.local
          Set up ovirt-provider-ovn               : True
          Configure WebSocket Proxy               : True
          DWH installation                        : True
          DWH database host                       : localhost
          DWH database port                       : 5432
          Configure local DWH database            : True
          Configure Image I/O Proxy               : True
          Configure VMConsole Proxy               : True


[ INFO  ] Restarting httpd
          Please use the user 'admin@internal' and password specified in order to login
          Web access is enabled at:
              http://ovirt.abc.local:80/ovirt-engine   // 접근하기 위한 URL
              https://ovirt.abc.local:443/ovirt-engine   // 접근하기 위한 URL
          Internal CA 74:F0:21:62:CF:18:E6:54:B4:48:37:7C:81:C8:4E:7E:3A:90:CC:3B
          SSH fingerprint: SHA256:Ihq6aQhN2gfUymsd84CuAcjmUnh9WngAK1JcuuZgqr0   // SSH 접근을 위해 기억하기
[WARNING] Less than 16384MB of memory is available
         
          --== END OF SUMMARY ==--
         
[ INFO  ] Stage: Clean up
          Log file is located at /var/log/ovirt-engine/setup/ovirt-engine-setup-20200622152524-t8r1th.log
[ INFO  ] Generating answer file '/var/lib/ovirt-engine/setup/answers/20200622154945-setup.conf'
[ INFO  ] Stage: Pre-termination
[ INFO  ] Stage: Termination
[ INFO  ] Execution of setup completed successfully

```
* vi /etc/hosts 추가
```
# vi /etc/hosts

192.168.122.10  ovirt.abc.local
192.168.122.21  hyper1.abc.local
192.168.122.22  hyper2.abc.local

:wq!

```


* ubuntu(사용자 PC) hosts 파일 추가 
```
# vi /etc/hosts
192.168.122.10 ovirt.abc.local
```

* 관리 페이지 접근


<img src="https://user-images.githubusercontent.com/56064985/85257783-5b235d00-b4a1-11ea-80e8-08ed1569a8f5.png" width="90%"></img>


<img src="https://user-images.githubusercontent.com/56064985/85257795-5eb6e400-b4a1-11ea-9c72-47862302f74a.png" width="90%"></img>


<img src="https://user-images.githubusercontent.com/56064985/85257804-6080a780-b4a1-11ea-82d0-d66fd6e23c14.png" width="90%"></img>


* Host 추가 및 관리


<img src="https://user-images.githubusercontent.com/56064985/85263051-91fd7100-b4a9-11ea-9616-fa719bd0af74.png" width="90%"></img>


<img src="https://user-images.githubusercontent.com/56064985/85263056-93c73480-b4a9-11ea-8239-297395934ec7.png" width="90%"></img>


<img src="https://user-images.githubusercontent.com/56064985/85265590-76946500-b4ad-11ea-82fb-3b4ae1f5707d.png" width="90%"></img>


---



#### 추가 공부 내용
```
Java Web Application
Web server
Web Application Server(WAS)
 Opensource : JBoss --> WildFly
 Eneterprise : JBoss ES
SAN(Storage Area Network)

FC-SAN : Fiber Chanel
 HBA(Host Bus Adapter) : FC
 FC Protocol
 SAN Switch
 
IP-SAN(iSCSI, FCoE...)
 Ethernet NIC
 TCP/IP Protocol
 Ethernet Switch

PSTN : 서킷 스위칭(회로 교환 방식)
VoIP(Voice over IP)
VOLTE(Voice over LTE) : 패킷 스위칭 방식

도커 강의 :https://www.slideshare.net/pyrasis/docker-fordummies-44424016

# 이미지 사이즈 줄이기
cd /var/lib/libvirt/images/
qemu-img create hyper2.raw 55G
qemu-img convert -O qcow2 hyper2.raw hyper2.qcow2
rm hyper2.raw
qemu-img info hyper2.qcow2


```


---
