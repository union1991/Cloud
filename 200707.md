Day 00.

## 목차
 
## 1. OpenStack 실습

> ### 1.4 OpenStack Orchestration(Heat) CLI



------------
 
## 1. OpenStack 실습


### 1.4 OpenStack Orchestration(Heat) CLI


#### Orchestration CLI

* openstack 설치
```
# sudo apt -y install python3-pip
# sudo apt -y install python3-openstackclient
# pip3 install oslo_log
# openstack
# /usr/bin/openstack complete |sudo tee /etc/bash_completion.d/openstack    // 자동기능 활성화를 위한 명령어(이후 터미널 재시작) 

```


* 자격증명 파일(Credential File)
> * openstack 웹을 통해 project-openrc.sh
```
# source project1-openrc.sh
# env |grep -i '^os_'
# /usr/bin/openstack catalog list
```



#### openstack RESOURCE ACTION [global option] [resource option] 

* RESOURCE
1. project
2. user
3. role
4. flavor
5. image
6. network
7. subnet
8. router
9. security group
10. key pair
11. floation ip
12. volume
13. server
14. container
15. object

* ACTION
1. create
2. delete
3. list
4. show
5. add
6. remove
7. set
8. config


#### openstack cli 생성

* project 생성
```
# source admin-openrc.sh
# /usr/bin/openstack project create project2
```

* user 생성
```
# /usr/bin/openstack user create --project project2 --password 'toor' user2
# /usr/bin/openstack role add --project project2 --user user2 _member_
# /usr/bin/openstack role add --project project2 --user user1 _member_
```


* 이미지 업로드
```
# source /home/student/Downloads/project2-openrc.sh 
# openstack image show Centos7
# openstack image create --disk-format qcow2 --file /home/student/Download/cirros-0.5.1-x86_64-disk.img Cirros
# openstack image set --protected Cirros
```


* 네트워크 생성(public)
```
# source /home/student/Downloads/admin-openrc.sh 
# openstack network create --provider-network-type flat --provider-physical-network extnet --external public
# openstack subnet create --subnet-range 192.168.122.0/24 --dns-nameserver 8.8.8.8 --allocation-pool start=192.168.122.100,end=192.168.122.200 --network public subnet-public // 현재 반영된 source의 프로젝트에 귀속된다
```


![Screenshot from 2020-07-08 14-35-43](https://user-images.githubusercontent.com/56064985/86880878-552bae00-c128-11ea-92ef-a4f4cef28fd5.png)



* 라우터 생성
```
# source /home/student/Downloads/project2-openrc.sh 
# openstack router create router
# openstack router set --external-gateway public router

# ssh root@192.168.122.10   // controller 접속
# ip netns
qrouter-14abe6cf-586d-4490-a591-b8e589d43ed6 (id: 1)
qdhcp-c23f1fb8-8f6e-4c54-83d4-0662aece4947 (id: 0)
qdhcp-9341a4cd-0ad0-426f-a989-a00489109b7d (id: 3)
# ip netns exec qrouter-14abe6cf-586d-4490-a591-b8e589d43ed6 ping google.co.kr
PING google.co.kr (172.217.175.227) 56(84) bytes of data.
64 bytes from nrt12s29-in-f3.1e100.net (172.217.175.227): icmp_seq=1 ttl=114 time=33.6 ms

```
<span style="color:red">붉은 색</span>


#### 추가 공부
* Message Queue : AMQP(Adbanced Message Queuing Protocol)
>> * RabbitMQ : 서비스끼리 통신하기 위한 수단


* 파이썬 버전 변경
```
$ sudo update-alternatives --install /usr/bin/python python /usr/bin/python2.7 1
$ sudo update-alternatives --install /usr/bin/python python /usr/bin/python3.6 2
$ sudo update-alternatives --config python
There are 2 choices for the alternative python (providing /usr/bin/python).

  Selection    Path                Priority   Status
------------------------------------------------------------
* 0            /usr/bin/python3.6   2         auto mode
  1            /usr/bin/python2.7   1         manual mode
  2            /usr/bin/python3.6   2         manual mode

Press <enter> to keep the current choice[*], or type selection number: 0
```

